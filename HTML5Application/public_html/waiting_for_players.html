<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>HootHoot Web App</title>

        <!-- Bootstrap Core CSS -->
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="css/landing-page.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Luckiest+Guy|Lobster+Two" rel="stylesheet">

        <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
        <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
        
    </head>
    
    <body>

        <!-- Header -->
        <div class="waitingpage-header">

            <!-- names of player who joined game -->
            <div class="row col-md-3  playerContainer">
                <div class="robotoFont" style="padding-top: 2%; margin-left: 15%; font-size: 20px">
                    <p class="robotoFont" style="font-size: 50px; font-weight: 100;">Players</p>
                    
                    <!-- Get player names from firebase in waiting_for_player.js -->
                    <ul id="player_name"></ul>
                </div>
            </div>
            
            <div>
                <div id="clockdiv" style="margin-left: 5%">
                    <div>
                        Time Remaining: <span class="seconds"></span>
                        <div class="smalltext">Seconds</div>
                    </div>
                </div>

                <!-- Station name Title -->
                <div class=" col-md-5 luckyGuyFont"> 
                    <p id="stn_name"></p>
                </div>

                <!-- Loading Gif -->
                <div class="row">
                    <div class="col-md-5">
                        <p class ="lob2Font" style="padding-left: 2%" id="state_ref"></p>
                        <iframe src="//giphy.com/embed/4AGlRfJwFDW00" width="500" height="400" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
                    </div>
                </div>
            </div>
            <!-- /.container -->

        </div>
        <!-- /.intro-header -->

        <!-- jQuery -->
        <script src="js/jquery.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="js/bootstrap.min.js"></script>

        <!-- Countdown timer -->
        <script src="js/waiting_for_player.js"></script>
        <script>
            // Retrieve station name from url
            var station_name = decode_url();
            
            // Constants for firebase url
            var FB_stationState_url = "https://mantrodev.firebaseio.com/STATIONS/HH_" + station_name + "/state";
            
            // Display countdown timer if state = starting
            var ref = new Firebase(FB_stationState_url);
            ref.on("value", function(snapshot) {
                var values = snapshot.val();
                if (values.toString() === "starting"){
                    var deadline = new Date(Date.parse(new Date()) + 15 * 24 * 60 * 60 * 1000);
                    initializeClock('clockdiv', deadline);
                }
            });
            
            // Function to get time left in countdown timer
            function getTimeRemaining(endtime) {
                var t = Date.parse(endtime) - Date.parse(new Date());
                var seconds = Math.floor((t / 1000) % 60);
                return {
                  'seconds': seconds
                };
            }
            
            // Function to display the clock
            function initializeClock(id, endtime) {
                var clock = document.getElementById(id);
                var secondsSpan = clock.querySelector('.seconds');
                
                // Function to update the value inside the countdown timer
                function updateClock() {
                    var t = getTimeRemaining(endtime);

                    secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);

                    if (t.seconds <= 0) {
                        ref.on("value", function(snapshot) {
                            var values = snapshot.val();
                            if (values.toString() === "starting"){
                                // Redirect to <div id="get_ready">
                            }
                            clearInterval(timeinterval);
                        });
                    }
                }

                // Update the countdown timer every second
                var timeinterval = setInterval(updateClock, 1000);
            }

            function decode_url(){
                // Decode url to get station name
                var search_query = window.location.search;
                var station = [];
                station = search_query.split('=');
                var station_name = station[1];
                var decode_station = [];
                decode_station = station_name.split('+');
                station_name = decode_station[0] + "_" + decode_station[1];
                window.onload = function(){
                    document.getElementById("stn_name").innerHTML = station_name;
                };
                return station_name;
            }
        </script>
        
    </body>
</html>
    