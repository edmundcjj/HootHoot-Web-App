<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>HootHoot Web App</title>

        <!-- Bootstrap Core CSS -->
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="css/landing-page.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Luckiest+Guy|Lobster+Two" rel="stylesheet">

        <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
        <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    </head>
    
    <body>

        <!-- state = waiting_for_players -->
        <div class="waiting_players_page" id="waiting_for_players">

            <!-- names of player who joined the game -->
            <div class="row col-md-3  playerContainer">
                <div class="robotoFont" style="padding-top: 2%; margin-left: 15%; font-size: 20px">
                    <p class="robotoFont" style="font-size: 50px; font-weight: 100;">Players</p>
                    
                    <!-- Get player names from firebase in waiting_for_player.js -->
                    <ul id="player_name" style="list-style: none;"></ul>
                </div>
            </div>
            
            <div>
                <div id="clockdiv" style="margin-left: 5%">
                    <div>
                        Time Remaining: <span class="seconds"></span>
                        <div class="smalltext">Seconds</div>
                    </div>
                </div>

                <!-- Station name Title -->
                <div class=" col-md-5 luckyGuyFont"> 
                    <p id="stn_name"></p>
                </div>

                <!-- Loading Gif -->
                <div class="row">
                    <div class="col-md-5">
                        <p class ="lob2Font" style="padding-left: 2%" id="state_ref"></p>
                        <iframe src="//giphy.com/embed/4AGlRfJwFDW00" width="500" height="400" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
                    </div>
                </div>
            </div>
            
            <!-- Countdown timer -->
            <script src="js/waiting_for_player.js"></script>
            <script>
                // Retrieve station name from url
                var station_name = decode_url();

                // Constants for firebase url
                var FB_stationState_url = "https://mantrodev.firebaseio.com/STATIONS/HH_" + station_name + "/state";

                // Display countdown timer if state = starting
                var ref = new Firebase(FB_stationState_url);
                ref.on("value", function(snapshot) {
                    var values = snapshot.val();
                    if (values.toString() === "starting"){
                        var deadline = new Date(Date.parse(new Date()) + 15 * 24 * 60 * 60 * 1000);
                        initializeClock('clockdiv', deadline);
                    }
                });

                // Function to get time left in countdown timer
                function getTimeRemaining(endtime) {
                    var t = Date.parse(endtime) - Date.parse(new Date());
                    var seconds = Math.floor((t / 1000) % 60);
                    return {
                      'seconds': seconds
                    };
                }

                // Function to display the clock
                function initializeClock(id, endtime) {
                    var clock = document.getElementById(id);
                    var secondsSpan = clock.querySelector('.seconds');

                    // Function to update the value inside the countdown timer
                    function updateClock() {
                        var t = getTimeRemaining(endtime);

                        secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);
                        
                        // Redirect to <div id="get_ready"> when countdown timer
                        // hits 0 and state = "starting"
                        if (t.seconds <= 0) {
                            ref = new Firebase(FB_stationState_url);
                            ref.on("value", function(snapshot) {
                                var values = snapshot.val();
                                if (values.toString() === "starting"){
                                    // Clear display of <div id="waiting_for_players">
                                    document.getElementById("waiting_for_players").style.display = "none";
                                    
                                    // Populate display of <div id="get_ready">
                                    document.getElementById("get_ready").style.display = "block";
                                }
                                clearInterval(timeinterval);
                            });
                        }
                    }

                    // Update the countdown timer every second
                    var timeinterval = setInterval(updateClock, 1000);
                }
                
                // Decode web url to retrieve current station name
                function decode_url(){
                    var search_query = window.location.search;
                    var station = [];
                    station = search_query.split('=');
                    var station_name = station[1];
                    var decode_station = [];
                    decode_station = station_name.split('+');
                    station_name = decode_station[0] + "_" + decode_station[1];
                    window.onload = function(){
                        document.getElementById("stn_name").innerHTML = station_name;
                    };
                    return station_name;
                }
            </script>
        </div>
        <!-- end of state = waiting_for_players -->
        
        <!-- state = get_ready -->
        <div class="get_ready_page" id="get_ready" style = "display:none">
            <h1>Get Ready State</h1>
            
            <script src="js/CMS_get_questions.js"></script>
        </div>
        <!-- end of state = get_ready -->
        
        <!-- state = answering_questions -->
        <div class="answering_qns_page" id="answering_questions" style = "display:none">
            <h1>answering_questions State</h1>
        </div>
        <!-- end of state = answering_questions -->
        
        <!-- state = answered -->
        <div class="answered_page" id="answered" style = "display:none">
            <h1>answered State</h1>
        </div>
        <!-- end of state = answered -->
        
        <!-- state = game_over -->
        <div class="game_over_page" id="game_over" style = "display:none">
            <h1>game_over State</h1>
        </div>
        <!-- end of state = game_over -->
        
        <!-- state = leaderboard -->
        <div class="leaderboard_page" id="leaderboard" style = "display:none">
            <h1>leaderboard State</h1>
        </div>
        <!-- end of state = leaderboard -->

        <!-- jQuery -->
        <script src="js/jquery.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="js/bootstrap.min.js"></script>

    </body>
</html>
    